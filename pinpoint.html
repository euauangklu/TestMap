<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pinpoint Map Diagnostic</title>
    
    <link href="https://unpkg.com/maplibre-gl@3.6.0/dist/maplibre-gl.css" rel="stylesheet" />
    <script src="https://unpkg.com/maplibre-gl@3.6.0/dist/maplibre-gl.js"></script>
    
    <style>
        body { margin: 0; padding: 0; font-family: monospace; background: #f0f0f0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; z-index: 1; opacity: 0; transition: opacity 0.5s; }
        
        /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏• (‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤) */
        #status-box {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 80%; max-width: 600px;
            background: white; padding: 20px; border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 100; text-align: center;
        }
        .loading { color: #666; font-size: 18px; }
        .error { color: #d32f2f; border: 2px solid #d32f2f; background: #ffebee; padding: 15px; }
        .success { color: #2e7d32; font-weight: bold; }
        .btn { margin-top: 15px; padding: 10px 20px; background: #333; color: white; border: none; cursor: pointer; }
    </style>
</head>
<body>

    <div id="status-box">
        <h2>üì° ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</h2>
        <p class="loading" id="msg">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Pinpoint Server<br>(‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô 1/2)</p>
        <div id="debug-info" style="font-size:12px; color:#999; margin-top:10px; text-align:left; white-space:pre-wrap; background:#eee; padding:5px; display:none;"></div>
    </div>

    <div id="map"></div>

    <script>
        // ============================================================
        // üîß ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
        // ============================================================
        const API_KEY = 'a4924394299efc07cb11d8f1449f257b90ea000222ff06e35d231e42721567676c8e98dbf1bf2561';
        
        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏•‡∏á‡πÑ‡∏õ‡πÉ‡∏ô URL ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Browser ‡∏à‡∏≥‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏° (Cache Busting)
        const TIMESTAMP = new Date().getTime();
        const STYLE_URL = `https://pin-point.co/maps/v1/styles/osm_bright.json?key=${API_KEY}&t=${TIMESTAMP}`;

        const statusBox = document.getElementById('status-box');
        const msg = document.getElementById('msg');
        const debugInfo = document.getElementById('debug-info');
        const mapDiv = document.getElementById('map');

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á Error
        function showError(title, detail, technical) {
            statusBox.innerHTML = `
                <h2 style="color:#d32f2f">‚ùå ${title}</h2>
                <p>${detail}</p>
                <div style="text-align:left; background:#eee; padding:10px; font-size:12px; margin-top:10px; overflow:auto;">
                    <strong>Technical Details:</strong><br>${technical}
                </div>
                <button class="btn" onclick="location.reload()">‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
            `;
        }

        // üöÄ ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏¢‡∏¥‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö (Test Fetch)
        // ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏•‡∏≠‡∏á‡∏î‡∏∂‡∏á‡πÑ‡∏ü‡∏•‡πå Style ‡∏°‡∏≤‡∏î‡∏π‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡πà‡∏≤‡∏î‡∏∂‡∏á‡πÑ‡∏î‡πâ‡πÑ‡∏´‡∏° ‡∏ñ‡πâ‡∏≤‡∏î‡∏∂‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤ Key/Referer ‡∏ú‡∏¥‡∏î‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô
        async function runDiagnostic() {
            try {
                debugInfo.style.display = 'block';
                debugInfo.innerText += `> Connecting to: ${STYLE_URL}\n`;

                const response = await fetch(STYLE_URL);
                
                debugInfo.innerText += `> Status: ${response.status} ${response.statusText}\n`;

                if (!response.ok) {
                    // ‡∏ñ‡πâ‡∏≤ Server ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏ß‡πà‡∏≤ Error (‡πÄ‡∏ä‡πà‡∏ô 403 Forbidden)
                    if (response.status === 403) {
                        showError("‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á (403)", "Server ‡∏Ç‡∏≠‡∏á Pinpoint ‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ñ‡∏£‡∏±‡∏ö", 
                            "‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ:\n1. Referer ‡πÉ‡∏ô Dashboard ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏ß‡πá‡∏ö‡∏ô‡∏µ‡πâ\n2. Key ‡∏ú‡∏¥‡∏î\n\nURL ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠: " + window.location.href);
                    } else if (response.status === 404) {
                        showError("‡∏´‡∏≤‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ (404)", "URL ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏ú‡∏¥‡∏î ‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏≤‡∏á Pinpoint ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô URL", "Checked URL: " + STYLE_URL);
                    } else {
                        showError("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "Server ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏õ‡∏Å‡∏ï‡∏¥", `Status: ${response.status}`);
                    }
                    return;
                }

                // üöÄ ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏ñ‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô ‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏£‡∏¥‡∏á
                msg.innerText = "‚úÖ ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏≤‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà...";
                msg.className = "success";
                
                initMap();

            } catch (err) {
                // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ (‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏ô‡πá‡∏ï‡∏´‡∏•‡∏∏‡∏î ‡∏´‡∏£‡∏∑‡∏≠ CORS ‡∏ö‡∏•‡πá‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö Hard Fail)
                showError("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (Network Error)", "Browser ‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠ URL ‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", err.message);
            }
        }

        function initMap() {
            try {
                const map = new maplibregl.Map({
                    container: 'map',
                    style: STYLE_URL,
                    center: [100.5018, 13.7563],
                    zoom: 12
                });

                map.on('load', () => {
                    // ‡∏ã‡πà‡∏≠‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß
                    statusBox.style.display = 'none';
                    mapDiv.style.opacity = 1;
                });

                map.on('error', (e) => {
                    console.error(e);
                    // ‡∏ñ‡πâ‡∏≤ maplibre ‡∏ü‡πâ‡∏≠‡∏á error
                    debugInfo.innerText += `> Map Error: ${e.error.message}\n`;
                });

            } catch (e) {
                showError("‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß", "Library ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", e.message);
            }
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
        runDiagnostic();

    </script>
</body>
</html>